<div class="glassmorphic-box p-6" data-aos="fade-up">
  <div class="flex flex-col sm:flex-row justify-end sm:items-center gap-2 mb-4">
    <button (click)="openCreateModal()" class="px-5 py-2 rounded-xl font-bold text-white bg-gradient-to-r from-green-400/80 to-sky-400/80 shadow-lg hover:from-green-400/100 hover:to-sky-400/100 transition border border-yellow-200/30 backdrop-blur flex items-center gap-2" data-aos="fade-down" data-aos-delay="400">
      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
      Create Category
    </button>
    <button (click)="downloadCategoriesReport()" class="px-5 py-2 rounded-xl font-bold text-white bg-gradient-to-r from-sky-400/80 to-blue-600/80 shadow-lg hover:from-sky-400/100 hover:to-blue-600/100 transition border border-yellow-200/30 backdrop-blur flex items-center gap-2" data-aos="fade-down" data-aos-delay="600">
      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v12m0 0l-4-4m4 4l4-4M4 20h16"/></svg>
      Download Report
    </button>
  </div>
  <div class="flex flex-row md:items-center md:justify-between gap-4 mb-4" data-aos="fade-down" data-aos-delay="800">
    <div class="relative w-72">
      <input type="text" [ngModel]="searchTerm()" (ngModelChange)="onSearchChange($event)" placeholder="Search categories..." class="rounded-xl px-4 py-2 bg-slate-800/70 text-white border-2 border-sky-400/30 focus:border-sky-400 outline-none w-full shadow-lg transition placeholder:text-sky-300" />
      <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400 pointer-events-none" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
    </div>
    <div class="flex gap-2 mt-0 items-center">
      <label for="sortBy" class="text-sky-300 font-semibold mr-2">Sort by:</label>
      <select id="sortBy" [ngModel]="sortKey()" (ngModelChange)="onSort($event)" class="rounded-xl px-4 py-2 bg-slate-800/70 text-white border-2 border-sky-400/30 focus:border-sky-400 outline-none shadow-lg">
        <option value="name">Name</option>
        <option value="productCount">Products</option>
        <option value="createdDate">Created</option>
      </select>
    </div>
  </div>
  <div *ngIf="loading()" class="flex flex-col items-center justify-center w-full py-8 animate-pulse">
    <svg class="w-8 h-8 text-sky-400 mb-2 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
    </svg>
    <span class="text-sky-300 text-lg font-semibold">Loading categories...</span>
  </div>
  <div *ngIf="!loading() && totalCategoriesCount() === 0" class="flex flex-col items-center justify-center w-full py-8">
    <svg class="w-8 h-8 text-slate-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2a4 4 0 018 0v2m-4-4v4m0 0v4m0-4H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-7z" />
    </svg>
    <span class="text-slate-400 text-lg font-semibold">No categories found.</span>
  </div>
  <div *ngIf="!loading() && totalCategoriesCount() > 0" class="overflow-x-auto">
    <table class="min-w-[700px] w-full bg-gradient-to-br from-[#232946]/80 to-[#1e293b]/80 rounded-2xl shadow-xl text-white">
      <thead>
        <tr class="text-sky-300 text-lg">
          <th class="p-3">Name</th>
          <th class="p-3">Products</th>
          <th class="p-3">Created</th>
          <th class="p-3 sm:sticky right-0 bg-gradient-to-br from-[#232946]/80 to-[#1e293b]/80 z-10 shadow-lg">Actions</th>
        </tr>
      </thead>
      <tbody class="text-center">
        <tr *ngFor="let cat of pagedCategories(); let i = index" class="hover:bg-sky-900/30 transition cursor-pointer" [attr.data-aos]="'fade-up'" [attr.data-aos-delay]="100 + (i-1) * 500">
          <td class="p-3 font-semibold">{{cat.name}}</td>
          <td class="p-3">{{cat.productCount}}</td>
          <td class="p-3">{{cat.createdDate ? (cat.createdDate | date:'mediumDate') : '-'}}</td>
          <td class="p-3 flex gap-2 justify-center sm:sticky right-0 bg-gradient-to-br from-[#232946]/80 to-[#1e293b]/80 z-10 shadow-lg" (click)="$event.stopPropagation()">
            <button (click)="openEditModal(cat)" class="px-3 py-1 rounded-lg bg-gradient-to-r from-yellow-400/80 to-orange-400/80 text-black font-bold shadow hover:from-yellow-400/100 hover:to-orange-400/100">Edit</button>
            <button (click)="openDeleteModal(cat)" class="px-3 py-1 rounded-lg bg-gradient-to-r from-red-500/80 to-pink-500/80 text-white font-bold shadow hover:from-red-500/100 hover:to-pink-500/100">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <app-pagination
      [page]="page()"
      [pageSize]="pageSize()"
      [total]="totalCategoriesCount()"
      (pageChange)="onPageChange($event)">
    </app-pagination>
  </div>

  <!-- Modal for Create/Edit Category -->
  <div *ngIf="showModal()" class="fixed overflow-y-auto inset-0 z-[1000] flex items-start justify-center bg-black/70 backdrop-blur-sm">
    <div class="relative bg-gradient-to-br from-[#232946]/95 to-[#1e293b]/95 rounded-3xl shadow-2xl border border-white/10 p-8 w-full max-w-md animate-fade-in mt-20 mb-8">
      <button (click)="closeModal()" class="absolute top-3 right-3 text-white text-2xl font-bold bg-slate-800/60 rounded-full w-9 h-9 flex items-center justify-center hover:bg-sky-700/80 transition">&times;</button>
      <h2 class="text-2xl font-extrabold text-white mb-4 tracking-wider drop-shadow-lg text-center">{{editMode() ? 'Edit Category' : 'Create Category'}}</h2>
      <form (ngSubmit)="saveCategory()" autocomplete="off" class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
          <label class="text-sky-200 font-semibold text-sm">Category Name</label>
          <input type="text" class="form-input bg-white/10 border border-sky-400/30 rounded-lg px-4 py-2 text-white placeholder-sky-300 focus:ring-2 focus:ring-sky-400 outline-none transition" placeholder="Category Name" [(ngModel)]="modalCategory().name" name="name" required maxlength="100">
        </div>
        <div class="flex gap-4 mt-2 justify-center">
          <button type="submit" class="px-6 py-2 rounded-xl font-bold text-white bg-gradient-to-r from-green-400/80 to-lime-400/80 shadow-lg hover:from-green-400/100 hover:to-lime-400/100 transition border border-yellow-200/30 backdrop-blur">{{editMode() ? 'Update' : 'Create'}}</button>
          <button type="button" (click)="closeModal()" class="px-6 py-2 rounded-xl font-bold text-white bg-gradient-to-r from-sky-400/80 to-violet-400/80 shadow-lg hover:from-sky-400/100 hover:to-violet-400/100 transition border border-yellow-200/30 backdrop-blur">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal for Delete Category Confirmation -->
  <div *ngIf="showDeleteModal" class="fixed inset-0 z-[1000] flex items-center justify-center bg-black/70 backdrop-blur-sm">
    <div class="relative bg-gradient-to-br from-[#232946]/95 to-[#1e293b]/95 rounded-3xl shadow-2xl border border-white/10 p-8 w-full max-w-md mx-4 animate-fade-in">
      <button (click)="closeDeleteModal()" class="absolute top-3 right-3 text-white text-2xl font-bold bg-slate-800/60 rounded-full w-9 h-9 flex items-center justify-center hover:bg-sky-700/80 transition">&times;</button>
      <div class="flex flex-col items-center gap-4">
        <svg class="w-14 h-14 text-red-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        <h3 class="text-xl font-bold text-white text-center">Delete Category</h3>
        <p class="text-slate-300 text-center">Are you sure you want to delete <span class="font-semibold text-red-300">{{deleteCategoryName}}</span>? This action cannot be undone.</p>
        <div class="flex gap-4 mt-2 justify-center">
          <button (click)="confirmDeleteCategory()" class="px-6 py-2 rounded-xl font-bold text-white bg-gradient-to-r from-red-500/80 to-pink-500/80 shadow-lg hover:from-red-500/100 hover:to-pink-500/100 transition border border-yellow-200/30 backdrop-blur">Delete</button>
          <button (click)="closeDeleteModal()" class="px-6 py-2 rounded-xl font-bold text-white bg-gradient-to-r from-sky-400/80 to-violet-400/80 shadow-lg hover:from-sky-400/100 hover:to-violet-400/100 transition border border-yellow-200/30 backdrop-blur">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
